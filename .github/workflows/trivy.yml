name: Trivy FS
on:
  pull_request:
  push:
    branches: [main]
permissions:
  contents: read
  security-events: write
jobs:
  trivy-fs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan repository with Trivy (config, secret, vuln)
        run: |
          docker run --rm             -v "$PWD:/repo"             -w /repo             aquasec/trivy:latest fs               --exit-code 1               --scanners vuln,secret,config               --format sarif               --output trivy-results.sarif               .
      - name: Upload SARIF
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: trivy-results.sarif
